<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content">

    <!-- 外部边框容器 -->
    <androidx.constraintlayout.widget.ConstraintLayout
        android:id="@+id/root_item_ai"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:paddingVertical="@dimen/spacing_s"
        android:paddingHorizontal="@dimen/spacing_m"
        android:background="@drawable/bg_item_msg_ai_border"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintBottom_toBottomOf="parent">

        <!-- 1. 深度思考组件 (复用) -->
        <include
            android:id="@+id/view_deep_think"
            layout="@layout/view_deep_think"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            app:layout_constraintTop_toTopOf="parent" />

        <!-- 2. 正文内容区域 (带气泡边框背景) -->
        <TextView
            android:id="@+id/tv_content"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="@dimen/spacing_s"
            android:background="@drawable/bg_bubble_ai"
            android:lineSpacingExtra="6dp"
            android:padding="@dimen/spacing_m"
            android:textColor="@color/text_primary"
            android:textSize="@dimen/text_body"
            android:textIsSelectable="true"
            app:layout_constraintTop_toBottomOf="@id/view_deep_think"
            tools:text="这是AI回复的正文内容。\n支持Markdown渲染，边框应该显示出来了。" />

        <!-- 3. 分割线 -->
        <View
            android:id="@+id/divider_actions"
            android:layout_width="match_parent"
            android:layout_height="1dp"
            android:layout_marginTop="@dimen/spacing_m"
            android:background="@color/divider"
            app:layout_constraintTop_toBottomOf="@id/tv_content" />

        <!-- 4. 底部按钮容器 -->
        <androidx.constraintlayout.widget.ConstraintLayout
            android:id="@+id/layout_actions"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="@dimen/spacing_s"
            app:layout_constraintTop_toBottomOf="@id/divider_actions">

            <!-- 左侧按钮组: 复制、语音、收藏 -->
            <LinearLayout
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toTopOf="parent">

                <!-- 复制 -->
                <ImageButton
                    android:id="@+id/btn_copy"
                    style="@style/SquareActionBtnStyle"
                    android:src="@drawable/ic_copy"
                    android:contentDescription="复制" />

                <Space android:layout_width="8dp" android:layout_height="wrap_content"/>

                <!-- 语音 (TTS) -->
                <ImageButton
                    android:id="@+id/btn_tts"
                    style="@style/SquareActionBtnStyle"
                    android:src="@drawable/ic_volume_up"
                    android:contentDescription="朗读" />

                <Space android:layout_width="8dp" android:layout_height="wrap_content"/>

                <!-- 收藏 -->
                <ImageButton
                    android:id="@+id/btn_favorite"
                    style="@style/SquareActionBtnStyle"
                    android:src="@drawable/ic_star"
                    android:contentDescription="收藏" />

            </LinearLayout>

            <!-- 右侧按钮组: 重说、删除 -->
            <LinearLayout
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toTopOf="parent">

                <!-- 重说 (Regenerate) -->
                <ImageButton
                    android:id="@+id/btn_regenerate"
                    style="@style/SquareActionBtnStyle"
                    android:src="@drawable/ic_refresh"
                    android:contentDescription="重新生成" />

                <Space android:layout_width="8dp" android:layout_height="wrap_content"/>

                <!-- 删除 -->
                <ImageButton
                    android:id="@+id/btn_delete"
                    style="@style/SquareActionBtnStyle"
                    android:src="@drawable/ic_trash_red"
                    app:tint="@color/error"
                    android:contentDescription="删除" />
            </LinearLayout>

        </androidx.constraintlayout.widget.ConstraintLayout>
    </androidx.constraintlayout.widget.ConstraintLayout>
</androidx.constraintlayout.widget.ConstraintLayout>
